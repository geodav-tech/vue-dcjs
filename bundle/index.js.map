{"version":3,"file":"index.js","sources":["../src/plugins/axis-chart.class.js","../src/plugins/dc.plugin.js","../src/dc-utils.js","../src/mixins/base-chart.mixin.vue","../src/index.js"],"sourcesContent":["import { CapMixin, ColorMixin, MarginMixin, transition } from 'dc'\nimport {axisBottom, extent as d3Extent, scaleLinear} from 'd3'\n\n// https://gist.github.com/ialarmedalien/ebca7eeb67c6d0b0a7809c46ef160cd0\n// Adapted into a class implementation by shawn@geodav.tech\n/**\n * Separate axis implementation.\n *\n * Examples:\n * - {@link https://bl.ocks.org/ialarmedalien/0a4bf25ffc0fb96ae569a20f91957bc1 eslint on dc.js source}\n * @class AxisChart\n * @example\n * // create an axis under #chart-container1 element using the default global chart group\n * var chart1 = new AxisChart('#chart-container1');\n * // create an axis under #chart-container2 element using chart group A\n * var chart2 = new AxisChart('#chart-container2', 'chartGroupA');\n * @param {String|node|d3.selection} parent - Any valid\n * {@link https://github.com/d3/d3-selection d3 single selector} specifying\n * a dom block element such as a div; or a dom element or d3 selection.\n * @param {String} [chartGroup] - The name of the chart group this chart instance should be placed in.\n * Interaction with a chart will only trigger events and redraws within the chart's group.\n */\nexport class AxisChart extends CapMixin(ColorMixin(MarginMixin)) {\n  _g\n  _scale\n  _elastic\n  _type = 'axisBottom'\n  _theAxis = axisBottom()\n  _axisData\n  validAxisTypes = ['axisBottom', 'axisTop', 'axisLeft', 'axisRight']\n  axisCap\n\n  calculateAxisScale () {\n    if (!this._scale || this._elastic) {\n      var extent = d3Extent(this._axisData, (d, i) => this.cappedValueAccessor(d, i))\n      if (extent[0] > 0) {\n        extent[0] = 0\n      }\n      if (extent[1] < 0) {\n        extent[1] = 0\n      }\n      this._scale = scaleLinear().domain(extent)\n        .range([0, (this._type === 'axisBottom' || this._type === 'axisTop' ? this.effectiveWidth() : this.effectiveHeight())])\n    }\n    this._theAxis.scale(this._scale)\n  }\n\n  drawAxis () {\n    var axisG = this._g.select('g.axis')\n\n    this.calculateAxisScale()\n\n    if (axisG.empty()) {\n      axisG = this._g.append('g').attr('class', 'axis')\n    }\n\n    transition(axisG, this.transitionDuration(), this.transitionDelay()).call(this._theAxis)\n  }\n\n  _doRender() {\n    this.minHeight(1)\n    this.height(50)\n    // idk why the minHeight, height kept getting reset\n    // so you must call these before resetSvg()\n    // otherwise the axisHeight is like 200px or 156px (depending on minHeight)\n    this.resetSvg()\n    this._g = this.svg().append('g').attr('transform', `translate(${this.margins().left}, ${this.margins().top})`)\n    this.drawChart()\n    return this\n  }\n\n  /**\n   * Gets or sets the axis type. The axis type can be any valid\n   * {@link https://github.com/d3/d3-axis d3 axis}. The default is\n   * axisBottom (a bottom axis).\n   * @see {@link https://github.com/d3/d3-axis d3 axis}\n   * @param {d3.type} [type]\n   * @returns {string|dc.axisChart} no args: type string; args: axis chart\n   */\n  type(type) {\n    if (!arguments.length) {\n      return this._type\n    }\n    if (this.validAxisTypes.indexOf(type) !== -1) {\n      this._theAxis = d3[type]()\n      this._type = type\n    } else {\n      console.error(type + ' is not a valid d3 axis type')\n    }\n    return this\n  }\n\n  /**\n   * Gets or sets the axis scale. The axis scale can be any d3\n   * {@link https://github.com/d3/d3-scale quantitative scale}.\n   * @see {@link https://github.com/d3/d3-scale quantitative scale}\n   * @param {d3.scale} [scale] any value d3 scale\n   * @returns {d3.scale|dc.axisChart} no args: chart scale; args: axis chart\n   */\n  scale (scale) {\n    if (!arguments.length) {\n      return this._scale\n    }\n    this._scale = scale\n    return this\n  }\n  \n  /**\n   * Get or set the elasticity on the axis. If this attribute is set to true,\n   * then the axis will rescale to auto-fit the data range when filtered.\n   * @param {Boolean} [elastic] any valid boolean\n   * @returns {Boolean|dc.axisChart} no args: boolean; args: axis chart\n   */\n  elastic (elastic) {\n    if (!arguments.length) {\n      return this._elastic\n    }\n    this._elastic = elastic\n    return this\n  }\n\n  /**\n   * Get the axis for the axis chart instance.\n   * See the {@link https://github.com/d3/d3-axis d3 axis object}\n   * documention for more information.\n   * @see {@link https://github.com/d3/d3-axis d3.axis}\n   * @example\n   * // customize axis tick format\n   * chart.axis().tickFormat(function (v) {return v + '%';});\n   * // customize axis tick values\n   * chart.axis().tickValues([0, 100, 200, 300]);\n   * @returns {d3.axis} d3 axis\n   */\n  axis() {\n    return this._theAxis\n  }\n\n  drawChart () {\n    this._axisData = this.data()\n    this.drawAxis()\n  }\n\n  _doRedraw () {\n    this.drawChart()\n    return this\n  }\n\n  constructor(parent, chartGroup) {\n    super(parent, chartGroup)\n    this.anchor(parent, chartGroup)\n  }\n}","import * as dc from 'dc'\nimport * as d3 from 'd3'\nimport crossfilter from 'crossfilter2'\nimport { AxisChart } from './axis-chart.class'\nrequire('dc/dist/style/dc.min.css')\n\ndc.AxisChart = AxisChart\n\n/**\n * import DcPlugin from 'this.file'\n * Vue.use(DcPlugin)\n * \n * binds dc, d3, and crossfilter to vue via $dc, $d3, $crossfilter\n */\nconst DcPlugin = {\n  install (Vue, options) {\n    if (options?.defaultColors) {\n      dc.config.defaultColors = options.defaultColors\n    }\n\n    Vue.prototype.$dc = dc\n    Vue.prototype.$d3 = d3\n    Vue.prototype.$crossfilter = crossfilter\n  }\n}\n\nexport default DcPlugin\nexport {\n  DcPlugin,\n  dc,\n  d3,\n  crossfilter\n}","/**\n * \n * @param {String | Function} accessor used for keyAccessor valueAccessor, label, title, etc.\n * @returns {Function} to use like this.chart.keyAccessor(accessorFunc(keyAccessor))\n */\nexport function accessorFunc(accessor) {\n  return typeof accessor === 'function' ? accessor : d => d[accessor]\n}\n\n/**\n * \n * @param {Number} target the value you wish to ensure is within the bounds\n * @param {Number} minValue the minimum returned value (inclusive)\n * @param {Number} maxValue the maximum returned value (inclusive)\n * @returns {Number} the target value, limited to the bounds provided by min/max inclusively\n */\nexport function constrain (target, minValue = -Infinity, maxValue = Infinity) {\n  return Math.max(minValue, Math.min(target, maxValue))\n}\n\n/**\n * \n * @param {Array} array 2d+ array \n * @returns  1d array\n */\nexport function flat (array) {\n  if (!Array.isArray(array)) {\n    return []\n  }\n  return array.reduce((acc, val) => acc.concat(val), [])\n}","<script>\nimport { accessorFunc } from '../dc-utils.js'\nexport default {\n  name: 'BaseChartMixin',\n  dimension: null, //crossfilter.dimension\n  myName: 'baseChart',\n  props: {\n    ndx: { // crossfilter object. e.g. this.$crossfilter(dataArray)\n      type: Object,\n      required: true\n    },\n    name: {\n      type: String\n    },\n    options: {\n      type: Object\n    }\n  },\n  baseDefaultOptions: {\n    disposeDimension: true,\n    render: true, // set false to stop rendering on startup\n    // beforeDestroy: dimension.dispose()\n    // valueAccessor: string, function,\n    // margins: {top, left, bottom, right},\n    // keyAccessor: string, function,\n    // title: string, function,\n    // label: string, function\n  },\n  data () {\n    return {\n      chart: null\n    }\n  },\n  mounted () {\n    this.drawChart()\n  },\n  methods: {\n    reset () {\n      if (this.chart) {\n        this.chart.filter(null)\n      }\n    },\n    drawChart() {\n      // clear chart?\n      this.createChart()\n      this.addChartExtras()\n      if (this.computedOptions.render) {\n        this.renderChart()\n      }\n    },\n    /**\n     * you are able to call this.$super(BaseChartMixin).drawChart()\n     * but you must create the chart first\n     */\n    createChart() {\n      const { valueAccessor, margins, keyAccessor, title, label, height, width } = this.computedOptions\n      if (valueAccessor) {\n        this.chart.valueAccessor(accessorFunc(valueAccessor))\n      }\n      if (margins) {\n        this.chart.margins(margins)\n      }\n      if (keyAccessor) {\n        this.chart.keyAccessor(accessorFunc(keyAccessor))\n      }\n      if (title) {\n        this.chart.title(accessorFunc(title))\n      }\n      if (label) {\n        this.chart.label(accessorFunc(label))\n      }\n\n      if (height) {\n        this.chart.height(height)\n      }\n      if (width) {\n        this.chart.width(width)\n      }\n    },\n    // allows children to hook into pre/post render hooks\n    renderChart () {\n      return new Promise((resolve) => {\n        this.$emit('pre-render', this.chart)\n        this.$nextTick(() => {\n          this.render()\n          this.$nextTick(() => {\n            this.$emit('post-render', this.chart)\n            return resolve(this.chart)\n          })\n        })\n      })\n    },\n    render () { // to be extended by children if needed\n      this.chart.render()\n    },\n    addChartExtras () {\n      if (this.name || this.computedOptions.name) {\n        this.chart.name = this.name || this.computedOptions.name\n      }\n      // set chart.vueOptions to be able to pass chart without having to additionally pass it's computedOptions\n      this.chart.vueOptions = this.computedOptions\n    }\n  },\n  computed: {\n    computedMargins () {\n      return Object.assign({ top: 30, right: 30, bottom: 30, left: 30 }, this.$options.defaultOptions?.margins, this.options?.margins)\n    },\n    computedOptions () {\n      return Object.assign({}, this.$options.baseDefaultOptions, this.$options.defaultOptions, this.options)\n    }\n  },\n  beforeDestroy () {\n    if (this.chart) {\n      // fix problems where things that change keys have filters that you can never recover data from\n      // clear all filters from dimension when chart is destroyed.\n      // this may want to become optional if:\n      //    charts share a dimension where:\n      //        one or more is expected to be destroyed\n      //        and one or more is expected to retain filtered state\n      const dim = this.chart.dimension()\n      if (dim) {\n        // FIXME store these and reapply filters?\n        dim.filterAll()\n      }\n      // we also cannot dispose of dimensions for this reason.\n      // though some charts should have an option for this\n      // all dc instances share a registry. take care of yourself\n      this.$dc.chartRegistry.deregister(this.chart)\n    }\n    if (this.computedOptions.disposeDimension && this.$options.dimension) {\n      this.$options.dimension.dispose()\n    }\n  }\n}\n</script>\n\n<style>\n\n</style>","// it seems important to use FULL filenames with extensions\nimport {DcPlugin, dc, d3, crossfilter} from './plugins/dc.plugin.js'\nimport {\n  DcBarChart,\n  DcChecklist,\n  DcPieChart,\n  DcRowChart\n} from './components'\n\nconst defaultOptions = {\n  registerComponents: true // Vue.component(everything) by default? will use dc-chart-name for prefixes\n  // defaultColors: for dc plugin, array of string colors (or I think there is a function definition as well)\n}\n\nconst VueDc = {\n  install (Vue, _options) {\n    const options = Object.assign({}, defaultOptions, options)\n    // hmm do we prevent this from polluting the namespace?\n    // what if the user overrides $super in their code??\n    // https://forum.vuejs.org/t/call-the-overrided-method-from-extend-mixin-think-super/1469\n    // https://github.com/iashraful/vue-super-call/blob/master/index.js\n    Vue.prototype.$super = function (options) {\n      return new Proxy(options, {\n        get: (options, name) => {\n          if (options.methods && name in options.methods) {\n            return options.methods[name].bind(this)\n          }\n        },\n      })\n    }\n\n    // register $dc, $d3, $crossfilter\n    Vue.use(DcPlugin, options)\n\n    // register out of the box components\n    if (options.registerComponents) {\n      Vue.component('dc-bar-chart', DcBarChart)\n      Vue.component('dc-checklist', DcChecklist)\n      Vue.component('dc-row-chart', DcRowChart)\n      Vue.component('dc-pie-chart', DcPieChart)\n    }\n  }\n}\n\n// fix warning prefer_named_exports by naming this export\nexport * from './components'\nexport {\n  VueDc,\n  dc,\n  d3,\n  crossfilter\n}"],"names":["AxisChart","CapMixin","ColorMixin","MarginMixin","parent","chartGroup","axisBottom","anchor","this","_scale","_elastic","extent","d3Extent","_axisData","d","i","_this2","cappedValueAccessor","scaleLinear","domain","range","_type","effectiveWidth","effectiveHeight","_theAxis","scale","axisG","_g","select","calculateAxisScale","empty","append","attr","transition","transitionDuration","transitionDelay","call","minHeight","height","resetSvg","svg","margins","left","top","drawChart","type","arguments","length","validAxisTypes","indexOf","d3","console","error","elastic","data","drawAxis","require","dc","DcPlugin","install","Vue","options","defaultColors","config","prototype","$dc","$d3","$crossfilter","crossfilter","accessorFunc","accessor","target","minValue","Infinity","maxValue","Math","max","min","defaultOptions","registerComponents","VueDc","_options","Object","assign","$super","Proxy","get","name","methods","bind","_this","use","component","DcBarChart","DcChecklist","DcRowChart","DcPieChart"],"mappings":";;;;2qGAsBaA,iSAAkBC,WAASC,aAAWC,6CA6HrCC,EAAQC,uIACZD,EAAQC,kFA1HR,gCACGC,mEAEM,CAAC,aAAc,UAAW,WAAY,yCAwHhDC,OAAOH,EAAQC,oDArHtB,0BACOG,KAAKC,QAAUD,KAAKE,SAAU,KAC7BC,EAASC,SAASJ,KAAKK,WAAW,SAACC,EAAGC,UAAMC,EAAKC,oBAAoBH,EAAGC,MACxEJ,EAAO,GAAK,IACdA,EAAO,GAAK,GAEVA,EAAO,GAAK,IACdA,EAAO,GAAK,QAETF,OAASS,gBAAcC,OAAOR,GAChCS,MAAM,CAAC,EAAmB,eAAfZ,KAAKa,OAAyC,YAAfb,KAAKa,MAAsBb,KAAKc,iBAAmBd,KAAKe,yBAElGC,SAASC,MAAMjB,KAAKC,gCAG3B,eACMiB,EAAQlB,KAAKmB,GAAGC,OAAO,eAEtBC,qBAEDH,EAAMI,UACRJ,EAAQlB,KAAKmB,GAAGI,OAAO,KAAKC,KAAK,QAAS,SAG5CC,aAAWP,EAAOlB,KAAK0B,qBAAsB1B,KAAK2B,mBAAmBC,KAAK5B,KAAKgB,mCAGjF,uBACOa,UAAU,QACVC,OAAO,SAIPC,gBACAZ,GAAKnB,KAAKgC,MAAMT,OAAO,KAAKC,KAAK,gCAA0BxB,KAAKiC,UAAUC,kBAASlC,KAAKiC,UAAUE,eAClGC,YACEpC,yBAWT,SAAKqC,UACEC,UAAUC,SAG4B,IAAvCvC,KAAKwC,eAAeC,QAAQJ,SACzBrB,SAAW0B,GAAGL,UACdxB,MAAQwB,GAEbM,QAAQC,MAAMP,EAAO,gCAEhBrC,MAREA,KAAKa,2BAkBhB,SAAOI,UACAqB,UAAUC,aAGVtC,OAASgB,EACPjB,MAHEA,KAAKC,8BAYhB,SAAS4C,UACFP,UAAUC,aAGVrC,SAAW2C,EACT7C,MAHEA,KAAKE,6BAkBhB,kBACSF,KAAKgB,kCAGd,gBACOX,UAAYL,KAAK8C,YACjBC,oCAGP,uBACOX,YACEpC,6FC5IXgD,QAAQ,4BAERC,EAAGzD,UAAYA,EAQf,IAAM0D,EAAW,CACfC,iBAASC,EAAKC,GACRA,MAAAA,GAAAA,EAASC,gBACXL,EAAGM,OAAOD,cAAgBD,EAAQC,eAGpCF,EAAII,UAAUC,IAAMR,EACpBG,EAAII,UAAUE,IAAMhB,EACpBU,EAAII,UAAUG,aAAeC,YCjB1B,SAASC,EAAaC,SACA,mBAAbA,EAA0BA,EAAW,SAAAxD,UAAKA,EAAEwD,ICJ5D,i/hBDcO,SAAoBC,OAAQC,0DAAYC,EAAAA,EAAUC,yDAAWD,EAAAA,SAC3DE,KAAKC,IAAIJ,EAAUG,KAAKE,IAAIN,EAAQG,koFERvCI,EAAiB,CACrBC,oBAAoB,GAIhBC,EAAQ,CACZrB,iBAASC,EAAKqB,OACNpB,EAAUqB,OAAOC,OAAO,GAAIL,EAAgBjB,GAKlDD,EAAII,UAAUoB,OAAS,SAAUvB,qBACxB,IAAIwB,MAAMxB,EAAS,CACxByB,IAAK,SAACzB,EAAS0B,MACT1B,EAAQ2B,SAAWD,KAAQ1B,EAAQ2B,eAC9B3B,EAAQ2B,QAAQD,GAAME,KAAKC,OAO1C9B,EAAI+B,IAAIjC,EAAUG,GAGdA,EAAQkB,qBACVnB,EAAIgC,UAAU,eAAgBC,GAC9BjC,EAAIgC,UAAU,eAAgBE,GAC9BlC,EAAIgC,UAAU,eAAgBG,GAC9BnC,EAAIgC,UAAU,eAAgBI"}